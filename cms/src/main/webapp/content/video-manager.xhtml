<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">

    <h:body id="root">
        <ui:composition template="/framework.xhtml">
            <ui:define name="import">
                <link rel="stylesheet" type="text/css" href="/resources/css/bootstrap-datetimepicker.min.css" />
                <link rel="stylesheet" type="text/css" href="/resources/css/video-info.css" />
            </ui:define>
            <ui:define name="content">
                <h:form styleClass="table-counter">
                    <label for="count" class="text-primary control-label">每页显示</label>
                    <h:inputText id="count" styleClass="input-table-counter" value="#{video.count}">
                        <f:ajax event="blur" render=":form" />
                    </h:inputText>
                    <h:outputText styleClass="text-primary" value="行" />
                </h:form>

                <h:form id="form">
                    <h:dataTable id="videos" styleClass="table table-striped table-hover table-responsive"
                                 columnClasses="table-col-id,table-col-file,table-col-title,table-col-index,table-col-duration,table-col-date,table-col-date,table-col-column,table-col-id,table-col-status,table-col-opera"
                                 value="#{video.videos}" var="item" first="#{(video.curPage-1) * video.count}" rows="#{video.count}" frame="below">
                        <h:column>
                            <f:facet name="header">ID</f:facet>
                            <h:outputText value="#{item.id}" />
                        </h:column>
                        <h:column>
                            <f:facet name="header">编号</f:facet>
                            <h:outputText value="#{item.file}" />
                        </h:column>
                        <h:column>
                            <f:facet name="header">标题</f:facet>
                            <h:outputText value="#{item.title}" />
                        </h:column>
                        <h:column>
                            <f:facet name="header">序号</f:facet>
                            <h:outputText value="#{item.sort==0?'-':item.sort}" />

                        </h:column>
                        <h:column>
                            <f:facet name="header">时长</f:facet>
                            <h:outputText value="#{item.duration}" />
                        </h:column>
                        <h:column>
                            <f:facet name="header">拍摄日期</f:facet>
                            <h:outputText value="#{item.shootTime}" />
                        </h:column>
                        <h:column>
                            <f:facet name="header">发布日期</f:facet>
                            <h:outputText value="#{item.pubDate}" />
                        </h:column>
                        <h:column>
                            <f:facet name="header">栏目</f:facet>
                            <h:outputText value="#{item.chatroomVideo?'聊天室':'其它'}" />
                        </h:column>
                        <h:column>
                            <f:facet name="header">荐</f:facet>
                            <input type="checkbox" value="#{item.recommend}" disabled="true" />
                        </h:column>
                        <h:column>
                            <f:facet name="header">状态</f:facet>
                            <h:outputText value="#{item.status.descript}" />
                        </h:column>
                        <h:column>
                            <f:facet name="header">操作</f:facet>
                            <h:panelGroup>
                                <h:commandLink styleClass="ui-icon ui-icon-search pull-left"
                                               title="#{item.title}-详细"
                                               p:data-toggle="modal" p:data-target="#amodal">
                                    <f:setPropertyActionListener value="#{item}" target="#{video.video}" />
                                    <f:setPropertyActionListener value="false" target="#{video.editable}" />
                                    <f:ajax render=":detail" />
                                </h:commandLink>
                                <h:commandLink styleClass="ui-icon ui-icon-pencil pull-left"
                                               title="编辑-#{item.title}"
                                               p:data-toggle="modal" p:data-target="#amodal">
                                    <f:setPropertyActionListener value="#{item}" target="#{video.video}" />
                                    <f:setPropertyActionListener value="true" target="#{video.editable}" />
                                    <f:ajax render=":detail" />
                                </h:commandLink>
                                <h:commandLink styleClass="ui-icon ui-icon-trash pull-right" />
                            </h:panelGroup>
                        </h:column>
                    </h:dataTable>
                    <ul class="pagination center-block">
                        <li>
                            <h:commandLink value="&laquo;">
                                <f:setPropertyActionListener value="1" target="#{video.curPage}" />
                                <f:ajax render="@form" />
                            </h:commandLink>
                        </li>
                        <li>
                            <h:commandLink value="&lsaquo;">
                                <f:setPropertyActionListener value="#{video.curPage - 1}" target="#{video.curPage}" />
                                <f:ajax render="@form" />
                            </h:commandLink>
                        </li>
                        <ui:repeat id="pager" value="#{video.pages}"
                                   size="#{video.curPage == 1?10:((video.curPage + 6)>=video.pageCount?video.pageCount:(video.curPage + 6))}"
                                   offset="#{video.curPage-4}" var="page">
                            <li class="#{page==video.curPage?'active':''}">
                                <h:commandLink value="#{page}">
                                    <f:setPropertyActionListener value="#{page}" target="#{video.curPage}" />
                                    <f:ajax render="@form" />
                                </h:commandLink>
                            </li>
                        </ui:repeat>
                        <li>
                            <h:commandLink value="&rsaquo;">
                                <f:setPropertyActionListener
                                    value="#{video.curPage + 1}"
                                    target="#{video.curPage}" />
                                <f:ajax render="@form" />
                            </h:commandLink>
                        </li>
                        <li>
                            <h:commandLink value="&raquo;">
                                <f:setPropertyActionListener value="#{video.pageCount}" target="#{video.curPage}" />
                                <f:ajax render="@form" />
                            </h:commandLink>
                        </li>
                    </ul>
                    <div class="table-counter pull-right">
                        <h:outputText styleClass="text-primary" value="共#{video.pageCount}页，跳转到第" />
                        <h:inputText styleClass="input-table-counter" value="#{video.curPage}">
                            <f:ajax event="blur" render="@form" />
                        </h:inputText>
                        <h:outputText styleClass="text-primary" value="页" />
                    </div>
                </h:form>
                <div id="amodal" class="modal">
                    <div class="modal-dialog modal-sm">
                        <h:panelGroup id="detail" styleClass="modal-content" layout="block">
                            <h:form>
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                    <h:outputText styleClass="modal-title h4" value="#{video.video.title}" />
                                </div>
                                <div class="modal-body">
                                    <dl class="dl-horizontal">
                                        <dt><h:outputLabel value="ID：" for="itemId" /></dt>
                                        <dd>
                                            <h:outputText id="itemId" value="#{video.video.id}" />
                                        </dd>
                                        <dt><h:outputLabel value="文件编号：" for="file" /></dt>
                                        <dd><h:outputText id="file" value="#{video.video.file}" /></dd>
                                        <dt><h:outputLabel value="排序编号：" /></dt>
                                        <dd>
                                            <h:outputText value="#{video.video.sort==0?'-':video.video.sort}" rendered="#{not video.editable}" />
                                            <h:inputText value="#{video.video.sort}" rendered="#{video.editable}" />
                                        </dd>
                                        <dt><h:outputLabel value="播放时长：" for="dur" /></dt>
                                        <dd><h:outputText id="dur" value="#{video.video.duration}" /></dd>
                                        <dt><h:outputLabel value="所属栏目：" /></dt>
                                        <dd><h:outputText value="#{video.video.chatroomVideo?'聊天室':'其它'}" rendered="#{not video.editable}" />
                                            <h:selectOneRadio value="#{video.video.chatroomVideo}" rendered="#{video.editable}">
                                                <f:selectItem itemLabel="聊天室" itemValue="true" />
                                                <f:selectItem itemLabel="其它栏目" itemValue="false" />
                                            </h:selectOneRadio></dd>
                                        <dt><h:outputLabel value="拍摄日期：" /></dt>
                                        <dd>
                                            <h:outputText value="#{video.video.shootTime}" rendered="#{not video.editable}" />
                                            <h:panelGroup styleClass="input-append date" id="datetimepicker" p:data-date="12-02-2012" p:data-date-format="dd-mm-yyyy" rendered="#{video.editable}">
                                                <h:inputText value="#{video.video.shootTime}" />
                                            </h:panelGroup>
                                        </dd>
                                        <dt><h:outputLabel value="当前状态：" for="status" /></dt>
                                        <dd><h:outputText id="status" value="#{video.video.status.descript}" /></dd>
                                        <dt><h:outputLabel value="是否推荐：" for="recommend" /></dt>
                                        <dd><h:outputText id="recommend" value="#{video.video.recommend?'是':'否'}" /></dd>
                                        <dt><h:outputLabel value="发布时间：" for="pub" /></dt>
                                        <dd><h:outputText id="pub" value="#{video.video.pubDate}">
                                            <f:convertDateTime type="time" pattern="yyyy-mm-dd hh:MM:ss" />
                                        </h:outputText></dd>
                                        <dt><h:outputLabel value="视频描述：" for="desc" /></dt>
                                        <dd>
                                            <h:outputText id="desc" value="#{video.video.descrpition}" />
                                        </dd>
                                        <dt><h:outputLabel value="文件大小：" /></dt>
                                        <ui:repeat value="#{video.video.extInfo}" var="info">
                                            <dd class="text-muted">
                                                <h:outputText value="#{info.resolution.descript} #{info.fileSize}MB" />
                                            </dd>
                                        </ui:repeat>
                                    </dl>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary">Save changes</button>
                                </div>
                            </h:form>
                        </h:panelGroup><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
            </ui:define>
            <ui:define name="js">
                <script type="text/javascript" src="/resources/js/bootstrap-datetimepicker.min.js"></script>
                <script type="text/javascript" src="/resources/js/bootstrap-datetimepicker.zh-CN.js"></script>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
